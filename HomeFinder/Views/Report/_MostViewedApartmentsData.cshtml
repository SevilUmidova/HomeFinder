@model HomeFinder.Models.Reports.MostViewedApartmentsReportVm
@using System.Text.Json

@{
    var payload = new
    {
        items = Model.Items.Select(x => new
        {
            apartmentId = x.ApartmentId,
            views = x.Views,
            district = x.District
        }).ToList()
    };

    var json = JsonSerializer.Serialize(payload);
}

<div id="chartBlock">
    <canvas id="viewsChart" style="min-height: 320px;"></canvas>
</div>

<script id="jsonBlock" type="application/json">@Html.Raw(json)</script>

<div id="tableBlock">
    <div class="table-responsive">
        <table class="table table-sm align-middle">
            <thead>
                <tr>
                    <th>Apartment</th>
                    <th>Address</th>
                    <th class="text-end">Views</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var x in Model.Items)
                {
                    var addr = $"{x.City}, {x.District}, {x.StreetAddress} {x.BuildingNumber}".Replace(" ,", ",").Trim(' ', ',');
                    <tr>
                        <td>#@x.ApartmentId</td>
                        <td>@(string.IsNullOrWhiteSpace(addr) ? "—" : addr)</td>
                        <td class="text-end fw-semibold">@x.Views</td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>